<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="520" viewBox="0 0 1400 520">
  <defs>
    <style type="text/css">
      .node { fill:#ffffff; stroke:#222; stroke-width:1.5; rx:6; ry:6; }
      .label { font-family: Arial, Helvetica, sans-serif; font-size: 14px; fill:#111; }
      .title { font-family: Arial, Helvetica, sans-serif; font-size: 18px; font-weight: bold; fill:#111; }
      .arrow { stroke:#555; stroke-width:1.4; marker-end:url(#arrowhead); fill:none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
  </defs>

  <text x="20" y="30" class="title">RAG Pipeline Flow (Static)</text>

  <!-- Row 1 -->
  <rect class="node" x="20" y="60" width="180" height="50"/>
  <text class="label" x="30" y="90">User Input: Query</text>

  <rect class="node" x="230" y="60" width="200" height="50"/>
  <text class="label" x="240" y="90">Load .env (dotenv)</text>

  <line class="arrow" x1="200" y1="85" x2="230" y2="85"/>

  <rect class="node" x="460" y="60" width="240" height="50"/>
  <text class="label" x="470" y="90">Load PDF (PyPDFLoader)</text>

  <line class="arrow" x1="430" y1="85" x2="460" y2="85"/>

  <rect class="node" x="730" y="60" width="270" height="50"/>
  <text class="label" x="740" y="90">Split Chunks (RecursiveCharacterTextSplitter)</text>

  <line class="arrow" x1="700" y1="85" x2="730" y2="85"/>

  <rect class="node" x="1030" y="60" width="230" height="50"/>
  <text class="label" x="1040" y="90">Init Embeddings (OpenAI)</text>

  <line class="arrow" x1="1000" y1="85" x2="1030" y2="85"/>

  <!-- Row 2 -->
  <rect class="node" x="20" y="150" width="250" height="50"/>
  <text class="label" x="30" y="180">Init Pinecone Client</text>

  <line class="arrow" x1="1145" y1="110" x2="145" y2="150"/>

  <rect class="node" x="300" y="150" width="380" height="50"/>
  <text class="label" x="310" y="180">Create/Populate Index (PineconeVectorStore.from_documents)</text>

  <line class="arrow" x1="270" y1="175" x2="300" y2="175"/>

  <rect class="node" x="710" y="150" width="260" height="50"/>
  <text class="label" x="720" y="180">Build Retriever (k=2)</text>

  <line class="arrow" x1="680" y1="175" x2="710" y2="175"/>

  <!-- Query time path -->
  <line class="arrow" x1="110" y1="110" x2="110" y2="150"/>
  <line class="arrow" x1="200" y1="85" x2="200" y2="150"/>

  <line class="arrow" x1="200" y1="85" x2="710" y2="150"/>

  <rect class="node" x="1000" y="150" width="200" height="50"/>
  <text class="label" x="1010" y="180">Similarity Search</text>
  <line class="arrow" x1="970" y1="175" x2="1000" y2="175"/>

  <rect class="node" x="1230" y="150" width="150" height="50"/>
  <text class="label" x="1240" y="180">Matched Docs</text>
  <line class="arrow" x1="1200" y1="175" x2="1230" y2="175"/>

  <!-- Row 3: LLM -->
  <rect class="node" x="20" y="240" width="220" height="50"/>
  <text class="label" x="30" y="270">ChatOpenAI (gpt-4o-mini)</text>

  <rect class="node" x="270" y="240" width="220" height="50"/>
  <text class="label" x="280" y="270">ChatPromptTemplate</text>

  <rect class="node" x="520" y="240" width="230" height="50"/>
  <text class="label" x="530" y="270">Stuff Documents Chain</text>

  <rect class="node" x="780" y="240" width="200" height="50"/>
  <text class="label" x="790" y="270">Retrieval Chain</text>

  <rect class="node" x="1010" y="240" width="180" height="50"/>
  <text class="label" x="1020" y="270">Generate Answer</text>

  <rect class="node" x="1210" y="240" width="170" height="50"/>
  <text class="label" x="1220" y="270">Return / Print Answer</text>

  <line class="arrow" x1="140" y1="110" x2="1210" y2="240"/>

  <line class="arrow" x1="20" y1="265" x2="270" y2="265"/>
  <line class="arrow" x1="490" y1="265" x2="520" y2="265"/>
  <line class="arrow" x1="750" y1="265" x2="780" y2="265"/>
  <line class="arrow" x1="980" y1="265" x2="1010" y2="265"/>
  <line class="arrow" x1="1190" y1="265" x2="1210" y2="265"/>

  <!-- Legend -->
  <rect class="node" x="20" y="330" width="640" height="160"/>
  <text class="label" x="30" y="355">Legend</text>
  <text class="label" x="30" y="380">1. Data prep: Load PDF, split chunks, build embeddings.</text>
  <text class="label" x="30" y="405">2. Indexing: Create Pinecone index from chunks.</text>
  <text class="label" x="30" y="430">3. Retrieval: Query -> retriever -> similarity search -> matched docs.</text>
  <text class="label" x="30" y="455">4. Generation: Prompt + ChatOpenAI -> documents chain -> final answer.</text>
</svg>
